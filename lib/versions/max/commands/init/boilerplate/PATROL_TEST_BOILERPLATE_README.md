# Patrol Integration Test Boilerplate

This is a **generic, reusable test boilerplate** designed for sg_cli's `init` command. It provides a solid foundation for Patrol integration testing in any Flutter project.

---

## ğŸ“ Structure

```
lib/test_utils/                         # ğŸŸ¢ GENERIC - Copy to new projects
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ base_patrol_test.dart           # Generic test patterns & app initialization
â”‚   â”œâ”€â”€ test_result.dart                # Structured result models (TestResult, VerificationResult)
â”‚   â”œâ”€â”€ test_logger.dart                # Minimal logging (success/error only)
â”‚   â””â”€â”€ test_constants.dart             # Generic timing constants
â””â”€â”€ shared/
    â””â”€â”€ ui_test_helpers.dart            # Generic UI helper utilities

integration_test/
â”œâ”€â”€ examples/                           # ğŸŸ¡ EXAMPLES - Shows usage patterns
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ login_test.dart             # Example: Complete test file
â”‚       â””â”€â”€ login_test_helpers.dart     # Example: Feature-specific helpers
â”œâ”€â”€ app_test.dart                       # Main test orchestrator
â””â”€â”€ test_bundle.dart                    # Auto-generated by Patrol (don't edit)
```

---

## ğŸ¯ What's Generic vs What's Example

### âœ… Generic (Use in all projects):
- **`lib/test_utils/base/`** - Core utilities that work for ANY Flutter app
- **`lib/test_utils/shared/`** - Reusable UI helpers

### ğŸ“– Examples (Reference for implementation):
- **`integration_test/examples/`** - Shows how to use the generic utilities
- Delete or modify examples for your specific project needs

---

## ğŸš€ How to Use in sg_cli Init

### 1. Copy Generic Utilities
```bash
# Copy to new project
cp -r lib/test_utils/ <new_project>/lib/
```

### 2. Update Package Name
In all copied files, replace:
```dart
import 'package:testcliinit/...'  // Old
import 'package:your_app_name/...' // New
```

### 3. Create Feature-Specific Tests
Follow the pattern in `integration_test/examples/auth/`:

```dart
// 1. Define your test data
class YourFeatureTestData {
  static const someValue = 'test';
  // ... your test constants
}

// 2. Create feature-specific helpers
class YourFeatureTestHelpers {
  static void testSomething() {
    BasePatrolTest.runTest('Test description', ($) async {
      // Your test logic using generic utilities
    });
  }
}
```

---

## ğŸ’¡ Key Features

### 1. **Graceful Exception Handling**
Tests return results instead of throwing exceptions:
```dart
final result = BasePatrolTest.verifyTextExistsGracefully('Login');
if (!result.success) {
  // Handle failure gracefully
}
```

### 2. **Minimal Logging**
Only failures are logged (no verbose noise):
```dart
TestLogger.logResult(result);  // Only logs if failed
TestLogger.error('Error message', exception: e);
```

### 3. **Structured Results**
```dart
class TestResult {
  final bool success;
  final String message;
  final Exception? exception;
  final StackTrace? stackTrace;
}

class VerificationResult extends TestResult {
  final String? expectedValue;
  final String? actualValue;
}
```

### 4. **Generic Timing Constants**
```dart
TestConstants.testWaitDuration          // 2 seconds
TestConstants.shortDelayDuration        // 500ms
TestConstants.networkTimeoutDuration    // 30 seconds
```

---

## ğŸ“ Example Usage (from examples/)

### Complete Test File:
```dart
import 'package:flutter_test/flutter_test.dart';
import 'login_test_helpers.dart';

void main() {
  LoginTestHelpers.testLoginScreenDisplay();
  LoginTestHelpers.testValidLogin();
  LoginTestHelpers.testInvalidEmailLoginGracefully();
}
```

### Feature Helper Class:
```dart
class LoginTestHelpers {
  static void testLoginScreenDisplay() {
    BasePatrolTest.runTest('Login screen displays', ($) async {
      BasePatrolTest.verifyElementExists(
        find.byKey(Keys.emailFieldKey),
        description: 'Email field should exist',
      );
    });
  }
}
```

---

## ğŸ”§ Dependencies Required

Add to `pubspec.yaml`:
```yaml
dev_dependencies:
  patrol: ^3.0.0
  integration_test:
    sdk: flutter
```

---

## âœ… Android Configuration Required

### `android/app/build.gradle.kts`:
```kotlin
android {
    defaultConfig {
        testInstrumentationRunner = "pl.leancode.patrol.PatrolJUnitRunner"
        testInstrumentationRunnerArguments["clearPackageData"] = "true"
    }
    
    testOptions {
        execution = "ANDROIDX_TEST_ORCHESTRATOR"
    }
}

dependencies {
    androidTestUtil("androidx.test:orchestrator:1.5.1")
}
```

### Native Bridge:
Create `android/app/src/androidTest/kotlin/<package>/MainActivityTest.kt`:
```kotlin
package com.example.yourapp

import org.junit.runner.RunWith
import pl.leancode.patrol.PatrolJUnitRunner

@RunWith(PatrolJUnitRunner::class)
class MainActivityTest {
    @org.junit.Test
    fun testApp() {
        pl.leancode.patrol.PatrolJUnitRunner.testApp(MainActivity::class.java)
    }
}
```

---

## ğŸ¯ Benefits for sg_cli

1. **âœ… 100% Generic** - No project-specific code in utilities
2. **âœ… Package Imports** - Clean, refactor-safe imports
3. **âœ… Example-Driven** - Clear patterns for developers to follow
4. **âœ… Graceful Errors** - Tests don't crash on failures
5. **âœ… Minimal Logging** - Clean output, only failures shown
6. **âœ… Production-Ready** - 0 errors, tested and working

---

## ğŸ“Š What Developers Get

When sg_cli runs `init` with this boilerplate:

```
âœ… Generic test utilities in lib/test_utils/
âœ… Example login tests in integration_test/examples/
âœ… Working Patrol configuration
âœ… Graceful exception handling
âœ… Clean, minimal logging
âœ… Ready to run: patrol test
```

Developers can:
1. **Run examples immediately** to see tests work
2. **Copy example patterns** to create their own tests
3. **Delete examples** when ready to build real tests
4. **Use generic utilities** for any feature testing

---

## ğŸš€ Commands

```bash
# Run all tests
patrol test

# Run on specific device
patrol test --device <device-id>

# Run with verbose output
patrol test --verbose
```

---

## ğŸ“š Documentation References

- **BasePatrolTest** - Generic test patterns and app initialization
- **TestResult/VerificationResult** - Structured error handling
- **TestLogger** - Minimal, failure-only logging
- **TestConstants** - Generic timing values

See example files in `integration_test/examples/auth/` for complete usage patterns.

---

**This boilerplate is ready for sg_cli integration!** ğŸ‰
